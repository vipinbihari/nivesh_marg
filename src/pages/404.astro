---
import { getCollection, type CollectionEntry } from 'astro:content';
import { compareDesc } from 'date-fns';
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/ui/PostCard.astro';

// Get recent posts for suggestions (safely handling empty collections)
let recentPosts: CollectionEntry<'posts'>[] = [];
try {
  const allPosts: CollectionEntry<'posts'>[] = await getCollection('posts');
  if (allPosts && allPosts.length > 0) {
    recentPosts = allPosts
      .sort((a: CollectionEntry<'posts'>, b: CollectionEntry<'posts'>) => {
        // Convert dates to Date objects for comparison
        const dateA = new Date(a.data.date);
        const dateB = new Date(b.data.date);
        return compareDesc(dateA, dateB);
      })
      .slice(0, 3);
  }
} catch (error) {
  console.error('Error fetching posts for 404 page:', error);
}
---

<BaseLayout 
  title="Page Not Found"
  description="Sorry, the page you were looking for doesn't exist or has been moved."
>
  <div class="max-w-4xl mx-auto px-4 py-16 text-center">
    <h1 class="text-6xl font-bold text-primary-600 dark:text-primary-400 mb-4">404</h1>
    
    <h2 class="text-3xl font-semibold text-gray-900 dark:text-white mb-6">
      Page Not Found
    </h2>
    
    <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">
      Sorry, the page you were looking for doesn't exist or has been moved.
      You can return to the homepage or check out some of our recent articles below.
    </p>
    
    <div class="mb-10">
      <a 
        href="/" 
        class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-md font-medium inline-block"
      >
        Return to Homepage
      </a>
    </div>
    
    <!-- Suggested posts -->
    <div class="mt-16">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">
        You might be interested in
      </h3>
      
      <div class="grid md:grid-cols-3 gap-8">
        {recentPosts.map((post) => (
          <PostCard post={post} lazyLoadImage={true} />
        ))}
      </div>
    </div>
  </div>
</BaseLayout>
